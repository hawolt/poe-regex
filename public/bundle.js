!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,(()=>(()=>{"use strict";var e;class t{constructor(e,t){this.mod=e,this.t17=t}getModifier(){return this.mod}isT17(){return this.t17}equals(e){return this===e||!!e&&this.mod===e.getModifier()&&this.t17===e.isT17()}}!function(e){e[e.INCLUSIVE=0]="INCLUSIVE",e[e.EXCLUSIVE=1]="EXCLUSIVE"}(e||(e={}));class n{constructor(e,t,n,o){this.modifiers=t,this.blacklist=o,this.excludes=n,this.t17=e}includes(e,t){for(const n of t)if(n.equals(e))return!0;return!1}substrings(e,t){let n=[],o=e.getModifier().toLowerCase();for(let e=0;e<o.length;e++)for(let r=e+1;r<=o.length;r++){let s=o.substring(e,r);1!=s.length&&(t.blacklisted(s)||n.push(s))}return n.sort(((e,t)=>e.length-t.length)),n}}class o extends n{check(e,t,n){if(this.excludes.blacklisted(e))return!1;for(let o=0;o<this.modifiers.length;o++){let r=this.modifiers[o];if(r.getModifier().toLowerCase().includes(e)){if(r.isT17()&&!this.t17)continue;let e=!1;for(const t of n)r.getModifier().toLowerCase().includes(t)&&(e=!0);if(e)continue;if(!this.includes(r,t))return!1}}return!0}create(e,t,n,o){if(0===n.length)return;if(o>this.modifiers.length)throw new Error("Infinite Recursion has been prevented");n=e.upgrade(this.t17,n,t);let r=new Set;for(let e=0;e<n.length;e++){let t=n[e];this.substrings(t,this.blacklist).forEach((e=>r.add(e)))}const s=new Map,i=Array.from(r).filter((e=>e.length>=2)).sort(((e,t)=>e.length-t.length));for(const e of i){if(e.length>=20)break;if(this.check(e,n,t))for(const t of n)t.getModifier().toLowerCase().includes(e.toLowerCase())&&(s.has(e)||s.set(e,0),s.set(e,(s.get(e)||0)+1))}let l=Array.from(s.entries());l.sort(((e,t)=>{const n=t[1]-e[1];return 0!==n?n:e[0].length+(e[0].includes("#")?2:0)-(t[0].length+(t[0].includes("#")?2:0))}));const c=l[0][0];n=n.filter((e=>!e.getModifier().toLowerCase().includes(c))),t.add(c),this.create(e,t,n,o+1)}}class r extends n{check(e,t,n){if(this.excludes.blacklisted(e))return!1;for(let n=0;n<this.modifiers.length;n++){let o=this.modifiers[n],r=o.getModifier().toLowerCase().includes(e.toLowerCase()),s=this.includes(o,t);if((!o.isT17()||this.t17)&&(!s&&r||s&&!r))return!1}return!0}create(e,t,n,o){if(0!==n.length)for(const e of n){let n=new Set,o=[];this.substrings(e,this.blacklist).forEach((e=>n.add(e)));for(const t in this.modifiers){let n=this.modifiers[t];n.getModifier().toLowerCase().includes(e.getModifier().toLowerCase())&&o.push(n)}o.push(e);let r=[],s=Array.from(n).sort(((e,t)=>e.length-t.length));for(const e of s)this.check(e,o,t)&&r.push(e);r.sort(((e,t)=>{const n=e.includes("#")||e.includes(" ")?e.length+2:e.length,o=t.includes("#")||t.includes(" ")?t.length+2:t.length;if(n!==o)return n-o;const r=e.includes(" ");return r===t.includes(" ")?0:r?1:-1})),r.length>0&&t.add(r[0])}}}class s{constructor(){this.blacklist=new Set}populate(e){for(let t=0;t<e.length;t++)this.blacklist.add(e[t].toLowerCase())}blacklisted(e){for(let t of this.blacklist)if(t.includes(e))return!0;return!1}}const i=[[90,[91]],[91,[90]],[18,[60]],[60,[18]],[17,[84]],[84,[17]],[40,[52]],[52,[40]],[49,[27]],[50,[27]],[27,[49,50]],[61,[25]],[64,[25]],[25,[61,64]],[66,[14]],[14,[66]],[72,[33]],[74,[33]],[75,[33]],[33,[72,74,75]],[86,[2]],[92,[2]],[2,[86,92]],[102,[21]],[21,[102]],[103,[22]],[22,[103]],[125,[1]],[1,[125]],[62,[0]],[0,[62]]];class l{constructor(e){this.mapping=new Map;let n=new Map;for(let o=0;o<i.length;o++){let r=i[o][0],s=e[r],l=new t(s.getModifier(),s.isT17());n.set(r,l)}for(let e=0;e<i.length;e++){let t=i[e],o=t[0],r=t[1],s=n.get(o),l=[];for(let e=0;e<r.length;e++){let t=r[e],o=n.get(t);o&&l.push(o)}s&&l&&this.mapping.set(s,l)}}upgrade(e,t,n){const o=new Set(t),r=Array.from(this.mapping.keys());for(const s of t)for(const t of r)if(s.equals(t)){let r=this.mapping.get(t)||[];for(const t of r)if(e||t.isT17()||t.getModifier().includes("#% more Monster Life")){let e=!1;for(const o of n)if(t.getModifier().toLowerCase().includes(o)){e=!0;break}e||o.add(t)}}return Array.from(o)}}const c=performance.now();let d=new Map,a=new Map,u=new s,f=[],h=[],g=[];function m(e){const t=document.getElementById("overlay"),n=document.getElementById("modal"),o=document.body;t.classList.toggle("hidden",!e),n.classList.toggle("hidden",!e),o.classList.toggle("no-scroll",e)}async function p(e){const t=e.map((e=>fetch(e).then((t=>{if(!t.ok)throw new Error(`Failed to load ${e}: ${t.status} ${t.statusText}`);return t.text()}))));return Promise.all(t)}function E(t,n,o){const r=document.createElement("div");return r.classList.add("selectable"),o.isT17()&&(r.classList.add("t17"),r.style.display="none"),r.dataset.mod=t.toString(),r.dataset.t17=o.isT17().toString(),r.textContent=o.getModifier(),r.addEventListener("click",(r=>{let s=r.target;if(s.classList.contains("disabled-item"))return;s.classList.toggle("selected-item");let l=s.classList.contains("selected-item"),c=n==e.EXCLUSIVE?h:g;!function(t,n,o,r){let s=o==e.EXCLUSIVE?"inclusive":"exclusive",i=document.querySelector(`#${s} .selectable[data-mod="${t}"]`);n?(i.classList.add("disabled-item"),L(!n,o==e.EXCLUSIVE?g:h,r)):i.classList.remove("disabled-item")}(t,l,n,o),L(l,c,o),function(t,n){const o=Object.values(e).filter((e=>"number"==typeof e));for(const r of i)if(r[0]===t){let t=r[1];for(const r of t)for(const t of o){let o=e[t].toLowerCase(),s=document.querySelector(`#${o} .selectable[data-mod="${r}"]`);n?s.classList.add("disabled-item"):s.classList.remove("disabled-item")}break}}(t,l),I()})),r}function L(e,t,n){if(e)t.push(n);else{const e=t.indexOf(n);e>-1&&t.splice(e,1)}}function y(e){var t;const n=e.value,o=null===(t=e.closest(".container-search"))||void 0===t?void 0:t.nextElementSibling,r=document.getElementById("t17");if(o&&o.classList.contains("mod-container")){let e=o.children;for(let t=0;t<e.length;t++){const o=e[t];o.textContent&&o.textContent.toLowerCase().includes(n.toLowerCase())?(r.checked&&"true"===o.dataset.t17||"false"===o.dataset.t17)&&(o.style.display=""):o.style.display="none"}}}function I(){document.getElementById("regex").innerText="crunching numbers...",document.getElementById("hint").innerText="",setTimeout((()=>{let t=document.getElementById("any").checked,n=C(!0,e.EXCLUSIVE),o=C(t,e.INCLUSIVE),r=function(){let e=b("quantity","optimize-quantity","m q"),t=b("pack-size","optimize-pack","iz"),n=b("scarabs","optimize-scarab","abs"),o=b("maps","optimize-maps","ps:"),r="";return e&&(r+=e),t&&(r+=t),n&&(r+=n),o&&(r+=o),r}(),s=function(){let t=document.getElementById("maps-include").checked?e.INCLUSIVE:e.EXCLUSIVE,n=[];document.getElementById("map-normal").checked&&n.push("n"),document.getElementById("map-rare").checked&&n.push("r"),document.getElementById("map-magic").checked&&n.push("m");let o=t==e.INCLUSIVE&&3!=n.length&&0!=n.length,r=t==e.EXCLUSIVE&&0!=n.length;return o||r?` "${t==e.EXCLUSIVE?"!":""}y: ${function(e){return 1==e.length?e[0]:`(${e.join("|")})`}(n)}"`:""}(),i=(n+(n.length>0?" ":"")+o+(o.length>0?" ":"")+r+s).trim();document.getElementById("regex").innerText=i;let l=document.getElementById("hint");l.innerText=i.length>0?`length: ${i.length} / 50`:"",l.style.color=i.length>50?"#ff4d4d":"#e0e0e0",m(!1)}),100)}function C(t,n){const i=document.getElementById("t17");let c=function(t){console.log(g),console.log(h),console.log("---");let n=new s;return t==e.EXCLUSIVE&&n.populate([...g].map((e=>e.getModifier()))),t==e.INCLUSIVE&&n.populate([...h].map((e=>e.getModifier()))),n}(n),m=t?new o(i.checked,f,c,u):new r(i.checked,f,c,u),p=n==e.EXCLUSIVE?h:g,E="";if(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(d.get(n)||[],p))E=a.get(n)||"";else{let o=new Set,r=new l(f);try{if(m.create(r,o,p,0),d.set(n,[...p]),t)E=Array.from(o).join("|").replace(/#/g,"\\d+"),E=E.length>0?`"${n==e.EXCLUSIVE?"!":""}${E}"`:"";else{let e="";for(const t of o){let n=t.replace(/#/g,"\\d+");e+=t.includes(" ")?`"${n}" `:`${n} `}E=e}a.set(n,E)}catch(e){console.error(e)}}return E}function b(e,t,n){let o=function(e,t){let n=parseFloat(e);if(isNaN(n))return null;if(0===n)return null;if(t&&(n=10*Math.floor(n/10)),0===n)return"";let o=Math.floor(n%100/10),r=n%10;if(n>=200)return"2..";if(199===n)return"199";if(n>100)return 0==r?`1[${o}-9].`:0===o?`(\\d0[${r}-9]|\\d[1-9].)`:9===o?8!=r?`19[${o}-9]`:"19[89]":`1([${o}-9][${r}-9]|[${o+1}-9].)`;if(100===n)return"\\d{3}";if(n>=10){if(0===r){let e;return e=9===o?"9.":8===o?"[89].":`[${o}-9].`,`(${e}|1..)`}return 9===o?`(${o}[${r}-9]|1..)`:`(${o}[${r}-9]|[${o+1}-9].|1..)`}return n<10?9===n?"(9|\\d..?)":8===n?"([89]|\\d..?)":n>1?`([${n}-9]|\\d..?)`:"":e}(document.getElementById(e).value,document.getElementById(t).checked);return null===o?null:""===o?`"${n}" `:`"${n}.*${o}%" `}function k(e){return e.filter((e=>!e.getModifier().includes("Corrupted")))}return document.addEventListener("DOMContentLoaded",(()=>{p(["./league/settler/map.name.config","./league/settler/map.affix.config","./league/settler/map.general.config","./league/settler/map.blacklist.config"]).then((e=>function(e){const t=new s;for(let n=0;n<e.length;n++){let o=e[n].split("\n");t.populate(o)}return t}(e))).then((n=>{u=n,async function(){p(["./league/settler/map.mods.config"]).then((e=>e[0])).then((n=>function(n){let o=n.split("\n"),r=document.querySelectorAll(".mod-container");for(let n=0;n<o.length;n++){let s=o[n].trim(),i=s.indexOf("(T17)");-1!=i&&(s=s.substring(6));const l=new t(s,-1!=i);f.push(l);for(let t=0;t<r.length;t++){let o=0==t?e.EXCLUSIVE:e.INCLUSIVE;r[t].appendChild(E(n,o,l))}}}(n)))}().then((()=>function(){document.querySelectorAll(".container-search").forEach((e=>{e.addEventListener("input",(e=>{y(e.target)}))})),document.getElementById("t17").addEventListener("change",(e=>{const t=e.target;document.querySelectorAll('[data-t17="true"]').forEach((e=>{let n=e;n.style.display=t.checked?"block":"none",t.checked||n.classList.remove("selected-item")})),document.querySelectorAll(".container-search").forEach((e=>{y(e)}))})),document.getElementById("generate").addEventListener("click",(()=>{d.clear(),m(!0),I()})),document.querySelectorAll(".trigger-0").forEach((e=>{e.addEventListener("change",(e=>{I()}))})),document.querySelectorAll(".trigger-1").forEach((e=>{e.addEventListener("input",(e=>{I()}))})),document.querySelectorAll(".trigger-2").forEach((t=>{t.addEventListener("input",(t=>{d.delete(e.INCLUSIVE)}))})),document.querySelectorAll(".trigger-3").forEach((n=>{n.addEventListener("input",(n=>{h=k(h),g=k(g);let o=null;switch(n.target.id){case"corrupted-include":o=e.INCLUSIVE;break;case"corrupted-exclude":o=e.EXCLUSIVE}if(null!=o){let n=new t("Corrupted",!1);(o===e.EXCLUSIVE?h:g).push(n)}I()}))}));const n=document.querySelectorAll('input[type="checkbox"]');n.forEach((e=>{e.addEventListener("change",(()=>{!function(e){const t=e.classList;let o="";for(const e of t)if(e.includes("btn-group-")){o=e;break}0!=o.length&&(e.checked?n.forEach((t=>{t.classList.contains(o)&&t!==e&&(t.checked=!1)})):Array.from(n).filter((e=>e.classList.contains(o))).some((e=>e.checked))||(e.checked=!0))}(e)}))}))}())).then((()=>function(){const e=performance.now()-c;console.log(`build-time ${e}ms`)}()))})).catch((e=>function(e){console.error(e)}(e)))})),{}})()));