!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var l in n)("object"==typeof exports?exports:e)[l]=n[l]}}(self,()=>(()=>{"use strict";var e;class t{constructor(e,t){this.t17=!1,this.vaal=!1,this.special=!1,this.fallback=null,this.bypass=new Set,this.mod=e,this.args=t,this.index=Number(t[0]),this.active=Boolean(t[1]);for(const e of t)if(e.startsWith("bypass"))e.split("=",2)[1].split(",").map(e=>Number(e)).forEach(e=>this.bypass.add(e));else if(e.startsWith("fallback"))this.fallback=e.split("=",2)[1],this.special=!0;else switch(e){case"t17":this.t17=!0;break;case"vaal":this.vaal=!0}}isIncludedBypass(e){return this.bypass.has(e)}getMetadata(){return[...this.args]}getFallback(){return this.fallback}getModifier(){return this.mod}getIndex(){return this.index}isActive(){return this.active}isSpecial(){return this.special}isVaal(){return this.vaal}isT17(){return this.t17}equals(e){return this===e||!!e&&this.fallback===e.getFallback()&&this.mod===e.getModifier()&&this.active===e.isActive()&&this.special===e.isSpecial()&&this.index===e.getIndex()&&this.vaal===e.isVaal()&&this.t17===e.isT17()}}!function(e){e[e.INCLUSIVE=0]="INCLUSIVE",e[e.EXCLUSIVE=1]="EXCLUSIVE"}(e||(e={}));class n{constructor(e,t){this.expression=t,this.ideal=e}getIdealResult(){return this.ideal}getRegularExpression(){return this.expression}}class l{constructor(e,t,n,l,i){this.modifiers=n,this.blacklist=i,this.excludes=l,this.vaal=t,this.t17=e}includes(e,t){for(const n of t)if(n.equals(e))return!0;return!1}substrings(e,t){let n=[],l=e.getModifier().toLowerCase(),i=l.split("\\n");for(let e=0;e<i.length;e++){let l=i[e];for(let e=0;e<l.length;e++)for(let i=e+1;i<=l.length;i++){let s=l.substring(e,i);1!=s.length&&(t.blacklisted(s)||n.push(s))}}return"corrupted"===l&&n.push("pte"),n.sort((e,t)=>e.length-t.length),n}optimize(e,t){let l,i=t[0].getFallback();if(null!=e){let n=[...new Set(t.filter(t=>t.getModifier().toLowerCase().includes(e)).map(e=>e.getFallback()))];1===n.length&&n[0]?(l=new RegExp(n[0]),e=n[0]):l=new RegExp(this.escape(e))}else{if(!i)throw new Error("Unable to find a result for specified configuration");l=new RegExp(i),e=i}return new n(e,l)}escape(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class i extends l{check(e,t,n){if(this.excludes.blacklisted(e))return!1;for(let l=0;l<this.modifiers.length;l++){let i=this.modifiers[l];if(i.getModifier().toLowerCase().includes(e)){if(i.isT17()&&!this.t17)continue;if(i.isVaal()&&!this.vaal)continue;let e=!1;for(const t of n)i.getModifier().toLowerCase().includes(t)&&(e=!0);if(e)continue;if(!this.includes(i,t))return!1}}return!0}create(e,t,n,l){if(0===n.length)return;if(l>this.modifiers.length)throw new Error("Infinite Recursion has been prevented");n=e.upgrade(this.t17,n,t);let i=new Set;for(let e=0;e<n.length;e++){let t=n[e];this.substrings(t,this.blacklist).forEach(e=>i.add(e))}const s=new Map,o=Array.from(i).filter(e=>e.length>=2).sort((e,t)=>e.length-t.length);for(const e of o){if(e.length>=20)break;if(!e.startsWith(" ")&&!e.endsWith(" ")&&this.check(e,n,t))for(const t of n)t.getModifier().toLowerCase().includes(e.toLowerCase())&&(s.has(e)||s.set(e,0),s.set(e,(s.get(e)||0)+1))}let r=Array.from(s.entries());r.sort((e,t)=>{const n=t[1]-e[1];return 0!==n?n:e[0].length+(e[0].includes("#")?3:0)-(t[0].length+(t[0].includes("#")?3:0))});let c=0!=r.length?r[0][0]:null,a=this.optimize(c,n),d=a.getRegularExpression(),u=a.getIdealResult();console.log(u),n=n.filter(e=>!e.getModifier().toLowerCase().split("\\n").some(e=>d.test(e))),t.add(u),this.create(e,t,n,l+1)}}class s extends l{check(e,t,n){if(this.excludes.blacklisted(e))return!1;for(let n=0;n<this.modifiers.length;n++){let l=this.modifiers[n],i=l.getModifier().toLowerCase().includes(e.toLowerCase()),s=this.includes(l,t);if((!l.isT17()||this.t17)&&(!l.isVaal()||this.vaal)&&(!s&&i||s&&!i))return!1}return!0}create(e,t,n,l){if(0!==n.length)for(const e of n){let l=new Set,i=[];this.substrings(e,this.blacklist).forEach(e=>l.add(e));for(const t in this.modifiers){let n=this.modifiers[t],l=e.getModifier().toLowerCase().includes(n.getModifier().toLowerCase()),s=n.getModifier().toLowerCase().includes(e.getModifier().toLowerCase());(l||s)&&i.push(n)}i.push(e);let s=[],o=Array.from(l).sort((e,t)=>e.length-t.length);for(const e of o)e.startsWith(" ")||e.endsWith(" ")||this.check(e,i,t)&&s.push(e);s.sort((e,t)=>{let n=e.length,l=t.length;if(n+=e.includes("#")?3:0,l+=t.includes("#")?3:0,n+=e.includes(" ")?2:0,l+=t.includes(" ")?2:0,n!==l)return n-l;const i=e.includes(" ");return i===t.includes(" ")?0:i?1:-1});let r=e.getFallback();if(s.length>0){let e=this.optimize(s[0],n).getIdealResult();t.add(e)}else r&&t.add(r)}}}class o{constructor(){this.blacklist=new Set,this.forbidden=new Set}populate(e){for(let t=0;t<e.length;t++)this.blacklist.add(e[t].toLowerCase().trim())}lock(e){for(let t=0;t<e.length;t++)0!==e[t].length&&this.forbidden.add(e[t].toLowerCase().trim())}blacklisted(e){for(let t of this.blacklist)if(t.includes(e))return!0;for(let t of this.forbidden)if(e.includes(t))return!0;return!1}}const r=[[9,[74]],[10,[81]],[12,[102,103]],[13,[98,104]],[22,[108]],[26,[78]],[27,[112]],[29,[96]],[30,[72]],[31,[68]],[33,[114]],[34,[115]],[35,[94]],[37,[73,76]],[39,[61,62]],[40,[95]],[45,[84,86,87]],[49,[118]],[52,[64]],[59,[111]],[61,[39]],[62,[39]],[64,[52]],[68,[31]],[72,[30]],[73,[37]],[74,[9]],[76,[37]],[78,[26]],[81,[10]],[84,[45]],[86,[45]],[87,[45]],[94,[35]],[95,[40]],[96,[29]],[98,[13]],[102,[12,103]],[103,[12,102]],[104,[13]],[108,[22]],[111,[59]],[112,[27]],[114,[33]],[115,[34]],[118,[49]]];class c{constructor(e){this.mapping=new Map;let n=new Map;for(let l=0;l<r.length;l++){let i=r[l][0],s=e[i],o=new t(s.getModifier(),s.getMetadata());n.set(i,o)}for(let e=0;e<r.length;e++){let t=r[e],l=t[0],i=t[1],s=n.get(l),o=[];for(let e=0;e<i.length;e++){let t=i[e],l=n.get(t);l&&o.push(l)}s&&o&&this.mapping.set(s,o)}}upgrade(e,t,n){const l=new Set(t),i=Array.from(this.mapping.keys());for(const s of t)for(const t of i)if(s.equals(t)){let i=this.mapping.get(t)||[];for(const t of i)if(!s.isIncludedBypass(t.getIndex())&&(e||t.isT17()||t.getModifier().includes("#% more Monster Life"))){let e=!1;for(const l of n)if(t.getModifier().toLowerCase().includes(l)){e=!0;break}e||l.add(t)}}return Array.from(l)}}const a=performance.now();let d=new Map,u=new Map,g=new o,m=[],h=[],f=[];function p(e,t){const n=document.getElementById("overlay"),l=document.getElementById(e),i=document.body;n.classList.toggle("hidden",!t),l.classList.toggle("hidden",!t),i.classList.toggle("no-scroll",t)}async function E(e){const t=e.map(e=>fetch(e).then(t=>{if(!t.ok)throw new Error(`Failed to load ${e}: ${t.status} ${t.statusText}`);return t.text()}));return Promise.all(t)}function I(t,n,l){const i=document.createElement("div");i.classList.add("selectable"),l.isT17()&&(i.classList.add("t17"),i.style.display="none"),l.isVaal()&&(i.classList.add("vaal"),i.style.display="none");let s=l.getFallback();return i.dataset.mod=t.toString(),i.dataset.t17=l.isT17().toString(),i.dataset.vaal=l.isVaal().toString(),i.dataset.special=l.isSpecial().toString(),i.dataset.fallback=null==s?"":s,i.textContent=l.getModifier().replace(/\\n/g,"\n"),i.addEventListener("click",i=>{let s=i.target;if(s.classList.contains("disabled-item"))return;s.classList.toggle("selected-item");let o=s.classList.contains("selected-item"),r=n==e.EXCLUSIVE?h:f;L(t,o,n,l),y(o,r,l),S(t,o),document.getElementById("optimize").checked||p("loading-modal",!0),w()}),i}function y(e,t,n){if(e)t.push(n);else{const e=t.indexOf(n);e>-1&&t.splice(e,1)}}function S(t,n){const l=Object.values(e).filter(e=>"number"==typeof e);for(const i of r)if(i[0]===t){let t=i[1];for(const i of t)for(const t of l){let l=e[t].toLowerCase(),s=document.querySelector(`#${l} .selectable[data-mod="${i}"]`);n?s.classList.add("disabled-item"):s.classList.remove("disabled-item")}break}}function L(t,n,l,i){let s=l==e.EXCLUSIVE?"inclusive":"exclusive",o=document.querySelector(`#${s} .selectable[data-mod="${t}"]`);n?(o.classList.add("disabled-item"),y(!n,l==e.EXCLUSIVE?f:h,i)):o.classList.remove("disabled-item")}function b(){document.getElementById("regex").innerText="",document.getElementById("hint").innerText="",h.length=0,f.length=0,d.clear(),u.clear(),document.querySelectorAll(".selected-item, .disabled-item").forEach(e=>{e.classList.remove("selected-item","disabled-item")})}function k(e){var t;const n=e.value,l=null===(t=e.closest(".container-search"))||void 0===t?void 0:t.nextElementSibling,i=document.getElementById("t17"),s=document.getElementById("vaal");if(l&&l.classList.contains("mod-container")){let e=l.children;for(let t=0;t<e.length;t++){const l=e[t];if(l.textContent&&l.textContent.toLowerCase().includes(n.toLowerCase())){let e=i.checked&&"true"===l.dataset.t17,t=s.checked&&"true"===l.dataset.vaal,n="false"===l.dataset.t17&&"false"===l.dataset.vaal;(e||t||n)&&(l.style.display="")}else l.style.display="none"}}}function v(){document.getElementById("regex").innerText="crunching numbers...",document.getElementById("hint").innerText="",setTimeout(()=>{let t=document.getElementById("any").checked;localStorage.setItem("any",String(t));let n=C(!0,e.EXCLUSIVE),l=C(t,e.INCLUSIVE),i=function(){let e=x("quantity","optimize-quantity","m q"),t=x("pack-size","optimize-pack","iz"),n=x("scarabs","optimize-scarab","abs"),l=x("maps","optimize-maps","ps:"),i=x("currency","optimize-currency","urr"),s=x("rarity","optimize-rarity","m r.*y"),o="";return e&&(o+=e),t&&(o+=t),n&&(o+=n),l&&(o+=l),i&&(o+=i),s&&(o+=s),o}(),s=function(){let t=document.getElementById("maps-include").checked?e.INCLUSIVE:e.EXCLUSIVE;localStorage.setItem("maps-include",t.toString());let n=[],l=document.getElementById("map-normal").checked;localStorage.setItem("map-normal",String(l)),l&&n.push("n");let i=document.getElementById("map-rare").checked;localStorage.setItem("map-rare",String(i)),i&&n.push("r");let s=document.getElementById("map-magic").checked;localStorage.setItem("map-magic",String(s)),s&&n.push("m");let o=t==e.INCLUSIVE&&3!=n.length&&0!=n.length,r=t==e.EXCLUSIVE&&0!=n.length;return o||r?` "${t==e.EXCLUSIVE?"!":""}y: ${function(e){return 1==e.length?e[0]:`(${e.join("|")})`}(n)}"`:""}(),o=n+" "+l;o+=l.trim().endsWith('"')?"":" ";let r=(o+i+s).trim();document.getElementById("regex").innerText=r,localStorage.setItem("regex",r);let c=document.getElementById("hint");c.innerText=r.length>0?`length: ${r.length} / 250`:"",c.style.color=r.length>250?"#ff4d4d":"#e0e0e0",p("loading-modal",!1)},100)}function w(){!document.getElementById("optimize").checked&&v()}function C(t,n){const l=document.getElementById("t17"),r=document.getElementById("vaal");localStorage.setItem("t17",l.checked.toString()),localStorage.setItem("vaal",r.checked.toString());let a=function(t){let n=new o;return t==e.EXCLUSIVE&&n.populate([...f].map(e=>e.getModifier())),t==e.INCLUSIVE&&n.populate([...h].map(e=>e.getModifier())),n}(n),p=t?new i(l.checked,r.checked,m,a,g):new s(l.checked,r.checked,m,a,g),E=n==e.EXCLUSIVE?h:f,I="";if(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(d.get(n)||[],E))I=u.get(n)||"";else{let l=new Set,i=new c(m);try{if(p.create(i,l,E,0),d.set(n,[...E]),t)I=Array.from(l).join("|").replace(/#/g,"\\d+"),I=I.length>0?`"${n==e.EXCLUSIVE?"!":""}${I}"`:"";else{let e="";for(const t of l){let n=t.replace(/#/g,"\\d+");e+=t.includes(" ")?`"${n}" `:`${n} `}I=e}u.set(n,I)}catch(e){console.error(e)}}return I}function x(e,t,n){let l=document.getElementById(e).value,i=document.getElementById(t).checked;localStorage.setItem(e,l.toString()),localStorage.setItem(t,String(i));let s=function(e,t){let n=parseFloat(e);if(isNaN(n))return null;if(0===n)return null;if(t&&(n>=100?n-=n%10:n=10*Math.floor(n/10)),0===n)return"";let l=Math.floor(n/100)%10,i=Math.floor(n%100/10),s=function(e,t,n,l,i){if(100===t)return"\\d..";if(t>100)return 0===i&&0===l?`[${n}-9]..`:0==i?9===l?`${n}9.`:8===l?`${n}[89].`:`${n}[${l}-9].`:0===l?9===i?`(${n}09|${n}[1-9].)`:8===i?`(${n}0[89]|${n}[1-9].)`:`(${n}0[${i}-9]|${n}[1-9].)`:9===l?8!=i?`${n}9[${l}-9]`:`${n}9[89]`:`${n}([${l}-9][${i}-9]|[${l+1}-9].)`;if(t>=10){if(0===i){let e;return e=9===l?"9.":8===l?"[89].":`[${l}-9].`,`(${e}|\\d..)`}if(9===l)return`(${l}[${i}-9]|\\d..)`;{let e=[];return 9===i?e.push("9"):8===i?e.push("[89]"):e.push(`[${i}-9]`),8===l&&e.push("9."),7===l?e.push("[89]."):e.push(`[${l+1}-9].`),`(${l}${e[0]}|${e[1]}|\\d..)`}}return t<10?9===t?"(9|\\d..?)":8===t?"([89]|\\d..?)":t>1?`([${t}-9]|\\d..?)`:"":e}(e,n,l,i,n%10);return console.log(s),n>=100&&0!=i?"("+s+`|[${l+1}-9]..)`:s}(l,i);return null===s?null:""===s?`"${n}"`:`"${n}.*${s}%"`}function $(e){return e.filter(e=>!e.getModifier().includes("Corrupted"))}function B(e){document.getElementById(e).addEventListener("change",t=>{const n=t.target;V(e,n.checked)})}function V(e,t){document.querySelectorAll("[data-"+e+'="true"]').forEach(e=>{let n=e;n.style.display=t?"block":"none",t||n.classList.remove("selected-item")}),document.querySelectorAll(".container-search").forEach(e=>{k(e)})}function U(e){const t=document.getElementById(e);t.checked=!0;const n=new Event("change",{bubbles:!0,cancelable:!0});t.dispatchEvent(n)}function M(e,t){for(const n of t)q(e,n)}function q(t,n){let l=t==e.EXCLUSIVE?"exclusive":"inclusive",i=document.querySelectorAll(`#${l} .selectable`);for(const e of i)if(e.textContent.toLowerCase().includes(n)){const t=new MouseEvent("click",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}}function A(e){const t=document.querySelectorAll('input[type="checkbox"]'),n=e.classList;let l="";for(const e of n)if(e.includes("btn-group-")){l=e;break}0!=l.length&&(e.checked?t.forEach(t=>{t.classList.contains(l)&&t!==e&&(t.checked=!1)}):Array.from(t).filter(e=>e.classList.contains(l)).some(e=>e.checked)||(e.checked=!0))}return document.addEventListener("DOMContentLoaded",()=>{E(["./league/settler/map.name.config","./league/settler/map.affix.config","./league/settler/map.general.config","./league/settler/map.blacklist.config"]).then(e=>function(e){const t=new o;for(let n=0;n<e.length-1;n++){let l=e[n].split("\n");t.populate(l)}return t.lock(e[e.length-1].split("\n")),t}(e)).then(n=>{g=n,async function(){E(["./league/settler/map.mods.config"]).then(e=>e[0]).then(n=>function(n){let l=n.split("\n"),i=document.querySelectorAll(".mod-container");for(let n=0;n<l.length;n++){let s=l[n].trim(),o=s.startsWith("$"),r=s.substring(1).split(";"),c=o?r.slice(0,-1):[];const a=new t(o?r[r.length-1]:s,c);m.push(a);for(let t=0;t<i.length;t++){let l=0==t?e.EXCLUSIVE:e.INCLUSIVE,s=I(n,l,a);if(l==e.EXCLUSIVE)i[t].appendChild(s);else{let e=i[t];e.children.length>0?e.insertBefore(s,e.children[0]):e.appendChild(s)}}}!function(){var t,n;const l=document.getElementById("t17"),i=localStorage.getItem("t17");i&&(l.checked="true"===i),V("t17",l.checked);const s=document.getElementById("vaal"),o=localStorage.getItem("vaal");o&&(s.checked="true"===o),V("vaal",s.checked);const r=localStorage.getItem("maps-include"),c=Number(null!=r?r:0);document.getElementById("maps-include").checked=c===e.INCLUSIVE,document.getElementById("maps-exclude").checked=c!==e.INCLUSIVE;let a=localStorage.getItem("map-normal");a&&(document.getElementById("map-normal").checked="true"===a);let d=localStorage.getItem("map-rare");d&&(document.getElementById("map-rare").checked="true"===d);let u=localStorage.getItem("map-magic");u&&(document.getElementById("map-magic").checked="true"===u);const g=localStorage.getItem("regex");g&&(document.getElementById("regex").innerText=g,(null!==(n=null===(t=g.match(/"([^"]*)"|(\S+)/g))||void 0===t?void 0:t.map(e=>e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e))&&void 0!==n?n:[]).forEach(t=>{var n;const l=-1!==t.indexOf("!",0)?"exclusive":"inclusive",s=null===(n=document.getElementById(l))||void 0===n?void 0:n.querySelector(".mod-container");if(s){const n=s.children,r=t.replace("!",""),c=new RegExp(r,"i");for(let t=0;t<n.length;t++){const s=n[t];if(("true"!==s.dataset.t17||"false"!==i)&&("true"!==s.dataset.vaal||"false"!==o)&&!s.classList.contains("disabled-item")&&s.textContent&&c.test(s.textContent)){let n=Number(s.dataset.mod);const i=m.find(e=>e.getIndex()===n);if(!i)continue;s.classList.toggle("selected-item");const o=s.classList.contains("selected-item"),r="exclusive"===l?e.EXCLUSIVE:e.INCLUSIVE,c=r===e.EXCLUSIVE?h:f;L(t,o,r,i),y(o,c,i),S(t,o)}}}}));let p=localStorage.getItem("corrupted");if(p){let e=document.getElementById(p);e.checked=!0,A(e)}function E(e,t){var n;document.getElementById(e).value=null!==(n=localStorage.getItem(e))&&void 0!==n?n:"";let l=localStorage.getItem(t);document.getElementById(t).checked=null===l||"true"===l}E("quantity","optimize-quantity"),E("pack-size","optimize-pack"),E("scarabs","optimize-scarab"),E("maps","optimize-maps"),E("currency","optimize-currency"),E("rarity","optimize-rarity")}()}(n))}().then(()=>(document.querySelectorAll(".container-search").forEach(e=>{e.addEventListener("input",e=>{k(e.target)})}),B("t17"),B("vaal"),document.getElementById("clear").addEventListener("click",()=>{b()}),document.getElementById("reset").addEventListener("click",()=>{localStorage.clear(),window.location.reload()}),document.getElementById("copy").addEventListener("click",()=>{let e=document.getElementById("regex").innerText;navigator.clipboard.writeText(e)}),document.getElementById("import").addEventListener("click",()=>{p("import-modal",!0)}),document.getElementById("generate").addEventListener("click",()=>{p("loading-modal",!0),v()}),document.getElementById("import-load").addEventListener("click",()=>{!function(){b(),U("t17"),U("vaal");let t=document.getElementById("import-string"),n=function(e){const t=/"([^"]*)"|[^\s]+/g;let n,l=[];for(;null!==(n=t.exec(e));)n[1]?l.push(n[1]):l.push(n[0]);return l}(t.value);t.value="";for(const t of n)if(t.startsWith("!")){let n=t.substring(1).split("|");M(e.EXCLUSIVE,n)}else if(n.includes("|")){let n=t.split("|");M(e.INCLUSIVE,n)}else{let n=t.startsWith('"')?t.substring(1,t.length-1):t;q(e.INCLUSIVE,n)}w()}()}),document.getElementById("report").addEventListener("click",()=>{window.open("https://github.com/hawolt/poe-regex/issues/new?assignees=&labels=bug&projects=&template=bug_report.md&title=","_blank")}),document.getElementById("suggest").addEventListener("click",()=>{window.open("https://github.com/hawolt/poe-regex/issues/new?assignees=&labels=enhancement&projects=&template=feature_request.md&title=","_blank")}),document.querySelectorAll(".close-modal").forEach(e=>{e.addEventListener("click",function(e){const t=e.target.closest(".modal-content");t&&t.parentElement&&t.parentElement.id&&p(t.parentElement.id,!1)})}),document.querySelectorAll(".trigger-0").forEach(e=>{e.addEventListener("change",e=>{w()})}),document.querySelectorAll(".trigger-1").forEach(e=>{e.addEventListener("input",e=>{w()})}),document.querySelectorAll(".trigger-2").forEach(t=>{t.addEventListener("input",t=>{d.delete(e.INCLUSIVE)})}),document.querySelectorAll(".trigger-3").forEach(n=>{n.addEventListener("input",n=>{h=$(h),f=$(f);let l=n.target,i=null;switch(localStorage.setItem("corrupted",l.id),l.id){case"corrupted-include":i=e.INCLUSIVE;break;case"corrupted-exclude":i=e.EXCLUSIVE}if(null!=i){let n=new t("Corrupted",[]);(i===e.EXCLUSIVE?h:f).push(n)}w()})}),document.querySelectorAll(".trigger-4").forEach(e=>{e.addEventListener("change",e=>{d.clear(),w()})}),void document.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>{A(e)})}))).then(()=>function(){const e=performance.now()-a;console.log(`build-time ${e}ms`)}())}).catch(e=>function(e){console.error(e)}(e))}),{}})());